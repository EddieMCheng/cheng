<!--http://eddie.cheng.se/V.html -->
<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></script><script type="text/javascript">
/*
	Copyright 2017 Eddie Cheng

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
var F="system=.01*point*.2u*.25v±.25*4w±3"
var G=["system.w=time/1000/60∞1"]
var V,I,U,gl,I2d,U2d,img=new Image,images=[],BvAtt,Bdv=[],BcAtt,Bdc=[],dv=[],dc=[],dvx=[],dvy=[],dvi=[]
var A,all,out,T="New"//±∞
var 让 =["C","CP","CD","C1","CE","T","F","M","W","Font","LS","VS","Vv","SS","IS","G","dT","dA"]
var C="slipxyzrgbuvwdta";	CP=["P",1,0,1,.5,.5,.5,1,1,1,1,0,0,0,0,0], CD=["p",1,0,1,.5,.5,.5,1,1,1,0,0,0,.5,0,0],	C1=["max",1000000,1,1,1,1,1,1,1,1,10,1000,1000,10,10,2]; CE=["±",0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0]
var B=[],D=[],E=[],H=[],L=[],P=[],N=0,Font="10px Sans-Serif",LS=1.5, VS="2.0", Vv=0, SS=512,IS=1,Vvm=0
var Mx=.5,My=.5,key="",MxB=[],MyB=[],keyB=[],算 ,抖 =1
var Gfrag,Gvert,vibms,go=1,time=0, dT=0.04,dA=1,qTime=0, ping=0,timeZone=new Date().getTimezoneOffset()/60;
var X=((Math.round(100*(24+(timeZone)%24)/24)/100)+"").replace("0.",".")
var websock=[],W="",dat=[],thisIdx=0;
updateL();F2DE();DE2B()
function init(){
	var ATD=window.location.href.replace("?",";").split(";");
	A=ATD[0];updateD(1,ATD);readTextUrl(T.includes(".txt")?T:T+".txt")
	if(gl){
		gl.clearColor(0,0,0,1)
		gl.clearDepth(1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL)
		window.requestAnimationFrame(loop)
	}
}
function updateT(s){
	var wsString=W?";W:"+W+";":""
	if(s)T=s; document.title=T; window.history.pushState(null, "Title", "?"+T+wsString)
}
function updateD(Tidx,arr){
	if(Tidx>=0)updateT(arr[Tidx])
	if(arr.length>2){
		for(var i=2;i<arr.length-1;i++)setVar(arr[i])
    if(typeof(G)=='string')G=G.split(",")
		D=[];E=[];inF();inG();outF()
	}
}
function readTextFile(){
	var file=loadD.files[0], reader = new FileReader()
	reader.onload=function(e){updateD(0,reader.result.split(";"))}
	reader.readAsText(file);
}
function readF(){
	var rdr=new FileReader()
	rdr.onload=function(){F=F+","+rdr.result;inF()}
	rdr.readAsText(loadF.files[0])
}
function readG(){
	var rdr=new FileReader()
	rdr.onload=function(){G.push(rdr.result);inG()}
	rdr.readAsText(loadG.files[0])
}
function readTextUrl(file){
	var raw = new XMLHttpRequest(); raw.open("GET", file, true); 
	raw.onreadystatechange = function (){
		if(raw.readyState==4&&(raw.status==200||raw.status==0)){
			if(raw.responseText){updateD(-1,raw.responseText.split(";"))}
			else if(file.includes("_"))readTextUrl(file.replace("_","/"))
			document.title=T
		}
		else if(raw.status==404 && file.includes("_"))readTextUrl(file.replace("_","/"))
	}
	raw.send(null);
}
function updateI(idx){
	if(I){
		I2d.scale(IS,IS)
		I2d.clearRect(0,0,I.width,I.height);
			if(idx>=0)img = images[idx]
			if(img){
			var cutw=img.width>img.height?img.width-img.height:0; var cuth=img.height>img.width?img.height-img.width:0 
			I2d.drawImage(img,-cuth/2,-cutw/2,img.width+cuth,img.height +cutw,0,0,SS,SS)
		}
	}
}
function updateU(idx){
	if(U){
		U2d.fillStyle="#FFFFFF"; U2d.textBaseline = "top"; U2d.textAlign = "left"; U2d.font=Font
		U2d.fillText(T,10,10)

		U2d.textAlign = "right"
		U2d.fillText(Font,SS-10,10)

		U2d.textAlign = "left";	U2d.textBaseline = "bottom"
		U2d.fillText(N+"",10,SS-10)

		U2d.fillStyle="#FFFFFF"
		U2d.textAlign = "right"
		U2d.fillText(算 ,SS-10,SS-10)
	}
}
function updateUP(idx,font,alpha){
	if(U){
		var goName=(L[D[idx][0]+".name"]+"")
		var goFont=L[D[idx][0]+".font"]
		var goAlign=L[D[idx][0]+".align"]
		var typeA=D[idx][L["a"]]+D[idx-D[idx][2]][L["a"]]%1
		U2d.textAlign =goAlign?goAlign:"left"
		U2d.fillStyle='rgba('+getByte(idx,"r")+','+getByte(idx,"g")+','+getByte(idx,"b")+','+(goName?1:typeA*alpha*D[idx][L["p"]])+')'
		U2d.font=goFont?goFont:font
		U2d.textBaseline = "top"
    	var names=typeA>0? D[idx][0].split("."):" "
		var dots=names.length>1?"...":"";
		U2d.fillText(goName!="undefined"?goName:(names[0]+dots),(SS/2)+dvx[idx]*(SS/2),(SS/2)-dvy[idx]*(SS/2))
	}
}
function getByte(idx,s){return Math.floor(D[idx][L[s]]*255)}
function readImgFile(idx){images[idx]=new Image; images[idx].onload = function(){updateI(idx)};	images[idx].src = URL.createObjectURL(imgInput.files[0])}

function download(type, text, ext) {
	filename= type+"_"+T+"_"+HE()+X+"."+ext
	var pom = document.createElement('a'); pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + text); pom.setAttribute('download', filename);
	if (document.createEvent) {var event = document.createEvent('MouseEvents'); event.initEvent('click', true, true);pom.dispatchEvent(event);}
	else pom.click();
}
function setVar(s){
	if(s){
		var sPair=s.split(":")
		var sVal=s.includes(",")?sPair[1].split(",").map(x=>parseFloat(x)?parseFloat(x):x):sPair[1]
		var sArr=sPair[0].split(".")
		if(sArr.length>1 && L[sArr[0]]!=undefined){
			var sName=sArr[0]
			var sType=sArr[sArr.length-1]
			if(sType == C[0])updateP(L[sName],sVal.replace(/ /g,"_"))
			else if(sType == "name" || sType == "font" || sType=="align")L[sPair[0]]=sPair[1]
			else if(sType.length==1 && sType.search(/[a-z]/g)==0){
				var sDE=sVal.split("±")
				D[L[sName]][L[sType]]=decimal3(parseFloat(sDE[0]))
				if(sDE.length==2)E[L[sName]][L[sType]]=decimal3(parseFloat(sDE[1]))
			}
			else{L[sPair[0]]=sVal}
		}
		else if(sArr[0]=="echo")alert(this[sVal])
		else if(sArr[0]=="IS"){
			IS=sVal
			updateI()
		}
		else if(sArr[0]=="dT")dT=parseFloat(sVal)
		else if(sArr[0]=="dA"){dA=sVal}
		else if(sArr[0]=="SS"){
			SS=sVal
			V.width=SS;V.height=SS
			I.width=SS;I.height=SS
			U.width=SS;U.height=SS
			updateI()
			gl.viewport(0,0,SS,SS)
		}
		else if(sArr[0]=="T")updateT(sVal)
		else if(sArr[0]=="W"){
			W=sPair[1]
			var dataArray=W.split(",")
			for(var i=0;i<dataArray.length;i++){
				if(dataArray[i]=="this"){thisIdx=i;window.addEventListener('devicemotion',function(ev){
					dat[thisIdx]=["device",time,ev.accelerationIncludingGravity.x,ev.accelerationIncludingGravity.y,ev.accelerationIncludingGravity.z]
				})}
				else{
					dat[i] = []
					websock[i] = new WebSocket('ws://'+dataArray[i]+':81');
					websock[i].idx=i;
					websock[i].onmessage = function(evt) {
						if(evt.data.includes(",")){
							dat[this.idx]=evt.data.split(",")
						}
					}
				}
			}
			updateT(T)
		}
		else if(sArr.length == 1){
			var lock=true
			for(var i=0;i<让 .length;i++)if(让 [i]==sArr[0])lock=false
			if(!lock)this[sArr[0]]=sVal.includes(",")?sVal.split(","):sVal
			
		}
	}
}
function updateP(idx, val){
	if(val == ""){
		var par = idx-D[idx][2]
		if(D.length > 2 && D[idx][2]!=0){
			var count=D[par][1]==2?2:1
			D.splice(idx+1-count,count); E.splice(idx+1-count,count);	dv.splice(idx+1-count,count); dc.splice(idx+1-count,count)
			N-=count
		}
	}
	else if(val.includes("+")){
		var count=D[idx][2]==0?D[idx][1]:1
		var cpD = D.slice(idx,idx+count),	cpE = E.slice(idx,idx+count);	cpdv=dv.slice(idx,idx+count);	cpdc=dc.slice(idx,idx+count)
		D.splice(idx,0,...cpD);				E.splice(idx,0,...cpE);	dv.splice(idx,0,...cpdv);	 dc.splice(idx,0,...cpdc);
		N+=cpD.length
	}
	else {D[idx][0]=val}
	DE2F();F2DE()
}
function updateL(){
	L=[]
	for(var i=0; i<C.length; i++){L[C[i]]=i}
	for(var j=D.length-1;j>=0;j--){
		var par=j-D[j][2]
		var nm=D[j][0].split(".")[0];
		var nNm = nm
		var ext=""
		if(nm.includes("(")){
			ext=nm.substring(nm.indexOf("("),nm.indexOf(")")+1)
			nNm=nNm.replace(ext,"")
			if(D[par][0].includes("(")&&D[j][2]!=0){ext="";L[j][0]=""}
		}
		var dp=0
		while((L[nNm+ext] || L[nNm+"_"+dp+ext]) && dp<D.length-1){
			var nmLen=nm.lastIndexOf("_")
			var nmArr=nmLen<0?nm:nm.substring(0,nmLen)
			var nmEndStr= parseInt(nm.substring(nmLen,nm.length)+1)
			nNm=nmEndStr?nmArr+"_"+nmEndStr:nmArr+"_"+dp
			dp++
		}
		L[nNm+ext] = j
		D[j][0]=D[j][0].replace(nm,nNm+ext)
	}
}
function DE2F(){
	F=""
	var C0
	for(var i=0; i<N+1; i++){
		if(D[i][2]==0)C0=CP
		else C0 = CD
		if(D[i][2]==0&&i>0)F+=","
		if(D[i][1]>0&&D[i][1]!=CD[1]&&D[i][2]!=0)F+=(D[i][1]+"").replace("0.",".")+"*"
		F+=D[i][0]
		for(var j=3;j<C.length;j++){
			var CEj=D[i][2]==0?1:CE[j]
			if(j!=2 && (D[i][j]!=C0[j]||E[i][j]!=CEj)&&(D[i][2]!=0||j!=1)){
				if(j>0)F+="*"
				if(D[i][j]!=1)	F+=(D[i][j]+"").replace("0.",".")
				if(j>2){		F+=C[j];if(E[i][j]!=CEj)F+="±"+(E[i][j]+"").replace("0.",".")}
			}
		}
		if(D[i][2]==0)F+="="
		else if(i<N && D[i+1][2]!=0) F+="+"
	}
}
function F2DE(){
	F=decodeURI(F)
	var commas=F.split(",")
	N=-1
	for(var I=0; I<commas.length; I++){
		var adds=commas[I].replace("=","+").split("+")
		for(var i=0; i<adds.length; i++){
			N++
			D[N]=[], E[N]=[],H[N]=[],	D[N][0]="", D[N][1]=i==0?adds.length:CP[1]; 	D[N][2]=i
			var multis=adds[i].split("*")
			for(var j=0; j<multis.length; j++){
				var props=multis[j].split("±")
				var prop=props[0]
				var number=Number(prop)
				if(!isNaN(number)&&i>0){D[N][1]*=number}
				else{
					var propValue=parseFloat(prop)
					var valueStrLen

					if(prop[0]==".")		valueStrLen=propValue.toString().length-1
					else if(propValue==0)	valueStrLen=1
					else if(!propValue){	valueStrLen=0;		propValue=1			}
	 				else{					valueStrLen=propValue.toString().length	}
					var propName=prop.substr(valueStrLen,prop.length-valueStrLen)
					var propIndex
					if(C.includes(propName)){propIndex=L[propName]}
					else {
						propIndex=1
 		 			}
					if(propIndex==1&&propName!=C[3]){
						if(D[N][0])D[N][0]+="."
						D[N][0] += propName
					}
					if(isNaN(D[N][propIndex]))D[N][propIndex]=1
					D[N][propIndex]*=propValue;		E[N][propIndex]=props[1] ? parseFloat(props[1]):D[N][2]==0?1:CE[propIndex]
				}
				if(multis[j].includes("("))H[N][j]=multis[j].substring(multis[j].indexOf("(")+1,multis[j].indexOf(")"))
				else H[N][j]=""
			}
			if(D[N][0]=="")		D[N][0]=CD[0]+big(Math.round(Math.random()*60))+big(Math.round(Math.random()*60))
			for(var ii=1; ii<C.length; ii++){
				if(isNaN(D[N][ii])) D[N][ii]=D[N][2]==0?CP[ii]:CD[ii];	if(isNaN(E[N][ii])) E[N][ii]=D[N][2]==0?1:CE[ii]
			}
		}
	}
	updateL();go=1;
}
function DE2B(){
	Bdv=[];Bdc=[];n=0
	if(U)U2d.clearRect(0,0,U.width,U.height);
	if(G && G.length>0 && G!=""){
		for(var i=0;i<G.length;i++){
			var GiPair = G[i].split("=");
			var valuePair=GiPair[1].split("±");
			var dValue
			if(GiPair[0][GiPair[0].length-2]==".")dValue=vdScript(valuePair[0],getD(GiPair[0]))
			else dValue=vdScript(valuePair[0],L[GiPair[0]])
			var eValue=valuePair.length==1?"":"±"+vdScript(valuePair[1],getE(GiPair[0]))
			setVar(GiPair[0]+":"+dValue+eValue);
		}
	}
	for(var i=N; i>0; i--){
		if(D[i][2]==0)i--
		var par=i-D[i][2]
		if(!dv[par] || i==N){dv[par]=[];dc[par]=[]}
		var len=DE(i,"l")
		var isFrac=len<1&&len>0
		var jlen=isFrac?Math.round(1/len+1):Math.ceil(len)
		var pdep=DE(i,"p")*PDE(i,"p")
		var nn=0
		var PArray=D[i][0].split(".")
		dv[i]=[];dc[i]=[];dvx[i]=0;dvy[i]=0
		for(var j=0; j<jlen; j++){
			var s=isFrac?j/(jlen-1):-1
			var d=DE(i,"d",s)
			if(PArray.length>1){
				var ii = d<0?0:d>=1?PArray.length-2:Math.floor((PArray.length-1)*d)
				var i0 = L[PArray[ii]]
				var i1 = L[PArray[ii+1]]
				if(i0 && i1){
					var d2 = (PArray.length-1)*d-ii
					var x=(1-d2)*DE(i0,"x",s)+d2*DE(i1,"x",s),	y=(1-d2)*DE(i0,"y",s)+d2*DE(i1,"y",s),	z=(1-d2)*DE(i0,"z",s)+d2*DE(i1,"z",s)
					var r=(1-d2)*DE(i0,"r",s)+d2*DE(i1,"r",s),	g=(1-d2)*DE(i0,"g",s)+d2*DE(i1,"g",s),	b=(1-d2)*DE(i0,"b",s)+d2*DE(i1,"b",s)
					var u=(1-d2)*DE(i0,"u",s)+d2*DE(i1,"u",s),	v=(1-d2)*DE(i0,"v",s)+d2*DE(i1,"v",s),	w=(1-d2)*DE(i0,"w",s)+d2*DE(i1,"w",s)				
				}
			}
			else{
				var x=DE(i,"x",s),		y=DE(i,"y",s),		z=DE(i,"z",s)
				var r=DE(i,"r",s),		g=DE(i,"g",s),		b=DE(i,"b",s)
				var u=DE(i,"u",s),		v=DE(i,"v",s),		w=DE(i,"w",s)				
			}
			var Pu = PDE(i,"u",s),		Pv = PDE(i,"v",s),	Pw = PDE(i,"w",s),	pii = 2*Math.PI
			var x1=u*Math.sin(v*pii)*Math.cos(w*pii)+(x*2-1), 	y1=u*Math.cos(v*pii)+(y*2-1),			z1=u*Math.sin(v*pii)*Math.sin(w*pii)+(z*2-1)
			var x2=x1*Math.cos(Pv*pii)+y1*Math.sin(Pv*pii),						y2=(y1*Math.cos(Pv*pii)-x1*Math.sin(Pv*pii))*Pu+(PDE(i,"y",s)*2-1)
			var x3=(x2*Math.cos(-Pw*pii)+z1*Math.sin(-Pw*pii))*Pu+(PDE(i,"x",s)*2-1), 	z2=(z1*Math.cos(-Pw*pii)-x2*Math.sin(-Pw*pii))*Pu+PDE(i,"z",s)
			var	x4=x3*Math.cos(Vvm*pii)+y2*Math.sin(Vvm*pii);	y3 =y2*Math.cos(Vvm*pii)-x3*Math.sin(Vvm*pii)
			var zScale=1/(2-z2),	m=j*4
			var x5=x4*zScale, y4 = y3*zScale
			var r1=r*zScale*PDE(i,"r",s), g1=g*zScale*PDE(i,"g",s), b1=b*zScale*PDE(i,"b",s)
			
			var idx=H[i][0]?L[H[i][0]]:L[H[par][0]]
			if(dv[idx] && idx!=i){
				for(var ii=0;ii<dv[idx].length;ii+=4){
					dv[i].push(dv[idx][ii]+x5-dvx[idx],dv[idx][ii+1]+y4-dvy[idx],1,1)
					dc[i].push(r1*D[idx][L["r"]],g1*D[idx][L["g"]],b1*D[idx][L["b"]],1)
					nn++
				}
				nn--
			}
			else{dv[i].push(x5,y4,1,1); dc[i].push(r1,g1,b1,1)}
				dvx[i]+=x5; dvy[i]+=y4
		}
		dvx[i]/=jlen;dvy[i]/=jlen
		updateUP(i,Font,1)
		dv[par]=dv[par].concat(dv[i]); dc[par]=dc[par].concat(dc[i])
		if(dv[i]){
			dvi[i]=Bdv.length
			var skip=pdep<1&&pdep>=0?Math.ceil(pdep*dv[i].length):dv[i].length
			Bdv = Bdv.concat(dv[i].slice(0,skip));Bdc = Bdc.concat(dc[i].slice(0,skip))
		}
		n+=jlen+nn
	}
	dvi[i]=Bdv.length
	算 =n
	
	updateU()

}

function showPosition(position){
	var lat = Math.round(100*(360-position.coords.latitude)/360)/100+""
	var lon = Math.round(100*(90-position.coords.longitude)/360)/100+""

	X=lat.replace("0.",".")+lon.replace("0.",".")
}
function setM(ev){MxB.unshift(Mx);MyB.unshift(My);Mx=decimal3(ev.touches[0].clientX/SS);My=decimal3(1-(ev.touches[0].clientY/SS))}
function start(){
	V=document.getElementById("glcanvas")
	I=document.getElementById('imgcanvas')
	U=document.getElementById('uicanvas')
	inF();inG();outVar()
	all=document.documentElement.innerHTML
	saV.value = "V ("+all.length/1000+" kb)"
	U.ontouchstart=function(ev){
		if(gLog.value.includes("Mx")||gLog.value.includes("My"))ev.preventDefault()
		setM(ev)
	}
	U.ontouchmove=function(ev){
		setM(ev)
	}
	U.ontouchend=function(ev){MxB=[],MyB=[]}
	document.onkeyup=function(ev){key="";keyB.unshift(ev.code);if(keyB.length>100)keyB.pop()}
	document.onkeydown=function(ev){
		var lock=true;go=1
		key=ev.code
		switch(ev.code){
			case "Up":I2d.globalAlpha+=0.1;updateI();break
			case "Down":I2d.globalAlpha-=0.1;updateI();break
			case "Backquote":setVar(prompt("Set variable",getVar("T")));break
			default:lock=false
		}
		if(lock)ev.preventDefault()
	}
	navigator.geolocation.getCurrentPosition(showPosition)	
	V.width=SS;V.height=SS
	I.width=SS;I.height=SS
	U.width=SS;U.height=SS

	gl=V.getContext("webgl")
	I2d=I.getContext('2d')
	U2d=U.getContext('2d')
	init()
}
function loop(){
	time= new Date().getTime()
	if(dT!=0&&time-qTime>dT*1000){qTime=time;go=1}
	if(go){
		DE2B(D,E);DE2F()
		out="D_"+T+";"+HE()+X+";SS:"+SS+";Font:"+Font+" ;VS:"+VS+";LS:"+LS+";Vv:"+Vv+";dT:"+dT+";C:"+C+"; CD:"+CD+";C1:"+C1+";CE:"+CE+";G:"+G+";F:"+F+";"+A;
		saveD.value="D_"+T+" ("+kb(out)+")"
		saveF.value="F_"+T+" ("+kb(F)+")"
		saveG.value="G_"+T+" ("+kb(gLog.value)+")"
		go=0;
		draw()
	}
	 ping= new Date().getTime()-time
	window.requestAnimationFrame(loop);
}
function draw(a) {
	if(!a)a=1
	var Bv,Bc
	gl.lineWidth(LS)
	Gfrag=loadShader(gl,gl.FRAGMENT_SHADER,"varying lowp vec4 vColor; void main(void) {gl_FragColor=vColor;}")
	Gvert=loadShader(gl,gl.VERTEX_SHADER,"attribute vec4 aVxyz; attribute vec4 aVrgb; varying lowp vec4 vColor; void main(void) {gl_Position =vec4(aVxyz); gl_PointSize="+VS+";vColor=aVrgb;}")
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	var Gprog=gl.createProgram()
	gl.attachShader(Gprog, Gvert);		gl.attachShader(Gprog, Gfrag)
	gl.linkProgram(Gprog);gl.useProgram(Gprog)
	BvAtt=gl.getAttribLocation(Gprog, "aVxyz");	gl.enableVertexAttribArray(BvAtt)
	BcAtt=gl.getAttribLocation(Gprog, "aVrgb");	gl.enableVertexAttribArray(BcAtt)


	Bv=gl.createBuffer(); 	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdv), gl.DYNAMIC_DRAW)
	Bc=gl.createBuffer();	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdc), gl.DYNAMIC_DRAW)

	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.vertexAttribPointer(BvAtt, 4, gl.FLOAT, 0, 0, 0)
	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.vertexAttribPointer(BcAtt, 4, gl.FLOAT, 0, 0, 0)
	for(var i=N; i>0; i--){
		var skip=1
		if(D[i][2]==0)i--
		if(D[i][2]==1 && i>1)skip=2
		var type=D[i][L["a"]]+D[i-D[i][2]][L["a"]]
		if(type==2)gl.drawArrays(gl.TRIANGLE_FAN, (dvi[i]/4), ((dvi[i-skip]-dvi[i])/4))
		else if(type==1)gl.drawArrays(gl.LINE_STRIP, (dvi[i]/4), ((dvi[i-skip]-dvi[i])/4))
		else gl.drawArrays(gl.POINT, (dvi[i]/4), ((dvi[i-skip]-dvi[i])/4))
	}
}
function vdScript(s,exc){
	var ext=""
	if(s&&(s.split("?").length-1)==(s.split("!").length))ext=":"+(exc?exc:"0")
	var s2=s?s.replace(/!/g,":").replace(/></g,"==").replace(/<>/g,"!=").replace(/<</g,"<=").replace(/>>/g,">=").replace(/([DENSW])\((\w+).(\w+)\)/g,"get$1\('$2.$3'\)").replace(/∞/g,"%")+ext:0
	return eval(s2)
}
function id(s){return document.getElementById(s)}
function inF(){fLog.value=F}
function outF(){F=fLog.value;F2DE()}
function inG(){gLog.value=G}
function outG(){G=gLog.value.split(",");}
function outVar(){valtxt.value=this[vartxt.value]}
function outVal(){setVar(vartxt.value+":"+valtxt.value);outVar()}
function getD(s){var pair=s.split(".");return L[pair[0]]?D[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getE(s){var pair=s.split(".");return L[pair[0]]?E[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getN(s){return L[s]?parseFloat(L[s]):0}
function getS(s){return L[s]?L[s]+"":""}
function getW(s){
	var sArr=s.split(".")
	var i=parseInt(sArr[0])
	var j=parseInt(sArr[1])
	return !dat[i]?0:dat[i][j]?dat[i][j]:0
}
function getVar(s){return s+":"+this[s]}
function loadShader(gl, type, source) {const shader = gl.createShader(type);gl.shaderSource(shader, source);gl.compileShader(shader);return shader;}
function c(v){return v.charCodeAt()}
function kb(s){return s.length/1000+" kb"}
function DE(i,str,s){return D[i][L[str]]+(Err(i,L[str],s)*E[i-D[i][2]][L[str]]);}
function PDE(i,str,s){return D[i-D[i][2]][L[str]];}
function Err(i,j,s){ if(E[i][j]==0)return 0;else if(s>=0)return E[i][j]*(2*s-1); else return E[i][j]*(Math.random()-Math.random())}
function big(v){return v>61?String.fromCharCode(v+945-62): v>35?String.fromCharCode(v+61):v>9?String.fromCharCode(v+55):v}
function big60(v){return ""+big(Math.floor(v/3600))+big(Math.floor((v%3600)/60))+big(Math.floor(v%60))}
function HE(){var date=new Date();return big60(11900+date.getYear())+big(date.getMonth()+1)+big(date.getDate())+big(date.getHours())+big(date.getMinutes())+big(date.getSeconds())+big(Math.floor(date.getMilliseconds()/40))}
function vib(ms){if(抖 )navigator.vibrate(ms)}
function decimal3(v){return Math.round(v*1000)/1000}
</script>
<style>
	html,body{margin:1px;padding:0}
	#imgcanvas,#uicanvas{position:absolute;left:1px;top:1px}
	textarea{width:100%}
	#saV{display:none}
</style>
</head><body onload="start()">
<canvas id="imgcanvas" class="wrap"></canvas>
<canvas id="uicanvas" class="wrap"></canvas>
<canvas id="glcanvas" class="wrap"></canvas>
<p><input id="saV" type="button" value="V" onclick="download('V',"all",'html')"></input></p>
<input id="loadD" type="file" onchange="readTextFile()"></input>
<input id="saveD" type="button" value="D" onclick="download('D',out,'txt')"></input>
	
	<p><input id="vartxt" onchange="outVar()" type="text" value="T">:<input id="valtxt" onchange="outVal()" type="text"></p>
	<textarea id="fLog" onchange="outF()" onfocus="inF()"></textarea>
	<input id="loadF" type="file" onchange="readF()"></input>
	<input id="saveF" type="button" value="F" onclick="download('F',F,'txt')"></input>
	<textarea id="gLog" onchange="outG()" onfocus="inG()"></textarea>
	<input id="loadG" type="file" onchange="readG()"></input>
	<input id="saveG" type="button" value="G" onclick="download('G',G,'txt')"></input>
<br>

<div id="imagediv">
Image:<input id="imgInput" type="file" accept="image/*;capture=camera" onchange="readImgFile(0)"></inpu>
</div>
</body></html>