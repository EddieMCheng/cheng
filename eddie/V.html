<!--http://eddie.cheng.se/V.html -->
<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></script><script type="text/javascript">
/*
	Copyright 2018 Eddie Cheng

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
var F="figure*.59w*.1a=core_1*.2499*-1z*0b*.5u*.125v±.5*a+core_0*.2499*0b*.5u*.125v±.5*a+core*.2499*z*0b*.5u*.125v±.5*a"
var G=["figure.w=Mx"]
var V,I,U,gl,I2d,U2d,img=new Image,images=[],BvAtt,Bdv=[],BcAtt,Bdc=[],dv=[],dc=[],dvx=[],dvy=[],dvz=[],dva=[],dvi=[]
var A,all,out,T="New"//±∞
var 让 =["C","CP","CD","CE","T","F","M","W","Font","LS","VS","Vv","SS","IS","G","dT"]
var C="slipxyzrgbuvwdta";	CP=["P",1,0,1,0,0,0,1,1,1,1,0,0,0,0,0], CD=["p",1,0,1,0,0,0,1,1,1,0,0,0,.5,0,0], CE=["±",0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0]
var B=[],D=[],E=[],L=[],P=[],N=0,Np=[],Nl=[],Font="10px Noto Sans",LS=1.5, VS="2.0", Vv=0,Vw=0, SS=512,IS=1,Vvm=0, Ia=1
var Mx=.5,My=.5,touch=0,key="",MxB=[],MyB=[],keyB=[],算 ,抖 =1
var Rx=0,Ry=0,Rz=0,ax=0,ay=0,az=0
var Gfrag,Gvert,vibms,go=1,time=0, dT=0,dA=1,qTime=0, ping=0,timeZone=new Date().getTimezoneOffset()/60;
var GPS=((Math.round(100*(24+(timeZone)%24)/24)/100)+"").replace("0.","."),LAT,LON,ALT
var websock=[],W="",dat=[],thisIdx=0;
updateL();F2DE();DE2B()
function init(){
	var ATD=window.location.href.replace("?",";").split(";");
	A=ATD[0];updateD(1,ATD)
	readTextUrl(ATD[1])
	if(gl){
		gl.clearColor(0,0,0,1)
		gl.clearDepth(-1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.GREATER)
		window.requestAnimationFrame(loop)
	}
}
function updateT(s){
	var wsString=W?";W:"+W+";":""
	if(s)T=s.replace("D_","").split(".")[0]; document.title=T; window.history.pushState(null, "Title", "?"+"D_"+T+".txt"+wsString)
}
function updateD(Tidx,arr){
	if(Tidx>=0)updateT(arr[Tidx])
	if(arr.length>2){
		for(var i=2;i<arr.length-1;i++)setVar(arr[i])
    if(typeof(G)=='string')G=G.split(",")
		D=[];E=[];inF();inG();F2DE();outVar();
	}
}
function readTextFile(){
	var file=loadD.files[0], reader = new FileReader()
	reader.onload=function(e){updateD(0,reader.result.split(";"))}
	reader.readAsText(file);
}
function readF(){
	var rdr=new FileReader()
	rdr.onload=function(){F=F+","+rdr.result;inF();F2DE();}
	rdr.readAsText(loadF.files[0])
}
function readG(){
	var rdr=new FileReader()
	rdr.onload=function(){G.push(rdr.result);inG()}
	rdr.readAsText(loadG.files[0])
}
function readTextUrl(file){
	var raw = new XMLHttpRequest(); raw.open("GET", file, true); 
	raw.onreadystatechange = function (){
		if(file && raw.readyState==4&&(raw.status==200||raw.status==0)){
			if(raw.responseText){updateD(0,raw.responseText.split(";"))}
			else if(file.includes("_"))readTextUrl(file.replace("_","/"))
			document.title=T
		}
		else if(raw.status==404 && file.includes("_"))readTextUrl(file.replace("_","/"))
	}
	raw.send(null);
}
function updateI(idx){
	if(I){
		I2d.scale(IS,IS)
		I2d.clearRect(0,0,I.width,I.height);
			if(idx>=0)img = images[idx]
			if(img){
			var cutw=img.width>img.height?img.width-img.height:0; var cuth=img.height>img.width?img.height-img.width:0 
			I2d.drawImage(img,-cuth/2,-cutw/2,img.width+cuth,img.height +cutw,0,0,SS,SS)
		}
	}
}
function updateU(idx){
	if(U){
		U2d.fillStyle="#FFFFFF"; U2d.textBaseline = "top"; U2d.textAlign = "left"; U2d.font=Font
		U2d.fillText(T,10,10)

		U2d.textAlign = "right"
		U2d.fillText(Font,SS-10,10)

		U2d.textAlign = "left";	U2d.textBaseline = "bottom"
		U2d.fillText(N+"",10,SS-10)

		U2d.fillStyle="#FFFFFF"
		U2d.textAlign = "right"
		U2d.fillText(算 ,SS-10,SS-10)
	}
}
function updateUP(i,font,alpha){
	var zS=dvz[i]>1.9?2:1/(2-dvz[i])
	if(U){
		var idx=Np[i]
		var goName=(L[D[i][0]+".name"]+"")
		var goFont=L[D[i][0]+".font"]
		var goAlign=L[D[i][0]+".align"]
		var typeA=D[i][15]+D[i-D[i][2]][15]%1
		U2d.textAlign =goAlign?goAlign:"left"
		U2d.fillStyle='rgba('+getByte(i,"r")+','+getByte(i,"g")+','+getByte(i,"b")+','+(goName?zS:zS*typeA*alpha*D[i][3])+')'
		U2d.font=goFont?goFont:font
		U2d.textBaseline = "top"
    	var names=typeA%1>0? D[i][0].split("."):" "
		var dots=names.length>1?"...":"";
		U2d.fillText(goName!="undefined"?goName:(names[0]+dots),(SS/2)+zS*dvx[i]*(SS/2),(SS/2)-zS*dvy[i]*(SS/2))
	}
}
function getByte(idx,s){return Math.floor(D[idx][L[s]]*255)}
function readImgFile(idx){images[idx]=new Image; images[idx].onload = function(){updateI(idx)};	images[idx].src = URL.createObjectURL(imgInput.files[0])}

function download(type, text, ext) {
	filename= type+"_"+T+"_"+HE()+GPS+"."+ext
	var pom = document.createElement('a'); pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + text); pom.setAttribute('download', filename);
	if (document.createEvent) {var event = document.createEvent('MouseEvents'); event.initEvent('click', true, true);pom.dispatchEvent(event);}
	else pom.click();
}
function setVar(s){
	if(s){
		var sPair=s.split(":")
		var sVal=s.includes(",")?sPair[1].split(",").map(x=>parseFloat(x)?parseFloat(x):x):sPair[1]
		var sArr=sPair[0].split(".")
		if(sArr.length>1 && L[sArr[0]]!=undefined){
			var sName=sArr[0]
			var sType=sArr[sArr.length-1]
			if(sType == "name" || sType == "font" || sType=="align")L[sPair[0]]=sPair[1]
			else if(sType.length==1 && sType.search(/[a-z]/g)==0){
				var sDE=sVal.split("±")
				D[L[sName]][L[sType]]=decimal3(parseFloat(sDE[0]))
				if(sDE.length==2)E[L[sName]][L[sType]]=decimal3(parseFloat(sDE[1]))
			}
			else{L[sPair[0]]=sVal}
		}
		else if(sArr[0]=="echo")alert(this[sVal])
		else if(sArr[0]=="IS"){
			IS=sVal
			updateI()
		}
		else if(sArr[0]=="Ia"){
			Ia=sVal
			I2d.globalAlpha=Ia
			updateI()
		}
		else if(sArr[0]=="dT")dT=parseFloat(sVal)
		else if(sArr[0]=="SS"){
			SS=sVal
			V.width=SS;V.height=SS
			I.width=SS;I.height=SS
			U.width=SS;U.height=SS
			updateI()
			gl.viewport(0,0,SS,SS)
		}
		else if(sArr[0]=="T")updateT(sVal)
		else if(sArr[0]=="W"){
			W=sPair[1]
			var dataArray=W.split(",")
			for(var i=0;i<dataArray.length;i++){
				com[i] = []
				websock[i] = new WebSocket('ws://'+dataArray[i]+':81');
				websock[i].idx=i;
				websock[i].onmessage = function(evt) {
					if(evt.data.includes(",")){
						com[this.idx]=evt.data.split(",")
					}
				}
				
			}
			updateT(T)
		}
		else if(sArr.length == 1){
			var lock=true
			for(var i=0;i<让 .length;i++)if(让 [i]==sArr[0])lock=false
			if(!lock)this[sArr[0]]=sVal.includes(",")?sVal.split(","):sVal
			
		}
	}
}
function updateL(){
	L=[]
	for(var i=0; i<C.length; i++){L[C[i]]=i}
	for(var j=D.length-1;j>=0;j--){
		var par=j-D[j][2]
		var nm=D[j][0].split(".")[0];
		var nNm = nm
		var dp=0
		while((L[nNm] || L[nNm+"_"+dp]) && dp<D.length-1){
			var nmLen=nm.lastIndexOf("_")
			var nmArr=nmLen<0?nm:nm.substring(0,nmLen)
			var nmEndStr= parseInt(nm.substring(nmLen,nm.length)+1)
			nNm=nmEndStr?nmArr+"_"+nmEndStr:nmArr+"_"+dp
			dp++
		}
		L[nNm] = j
		D[j][0]=D[j][0].replace(nm,nNm)
	}
}
function DE2F(){
	F=""
	var C0
	for(var i=0; i<N+1; i++){
		if(D[i][2]==0)C0=CP
		else C0 = CD
		if(D[i][2]==0&&i>0)F+=","
		F+=D[i][0]
		if(D[i][1]>0&&D[i][1]!=CD[1])F+="*"+(D[i][1]+"").replace("0.",".")
		for(var j=3;j<C.length;j++){
			var CEj=D[i][2]==0?0:CE[j]
			if(j!=2 && (D[i][j]!=C0[j]||E[i][j]!=CEj)&&(D[i][2]!=0||j!=1)){
				if(j>0)F+="*"
				if(D[i][j]!=1)	F+=(D[i][j]+"").replace("0.",".")
				if(j>2){		F+=C[j];if(E[i][j]!=CEj)F+="±"+(E[i][j]+"").replace("0.",".")}
			}
		}
		if(D[i][2]==0)F+="="
		else if(i<N && D[i+1][2]!=0) F+="+"
	}
}
function F2DE(){
	F=decodeURI(F)
	var commas=F.split(",")
	console.log(commas)
	N=-1
	Np=[],D=[],E=[],Nl=[]
	for(var I=0; I<commas.length; I++){
		var adds=commas[I].replace("=","+").split("+")
		var Np_=[],Nl_=[]
		var par=N+1
		for(var i=0; i<adds.length; i++){
			N++
			if(i>0){Np_.push(N);Nl_.push(adds.length-1)}
			D[N]=[], E[N]=[],	D[N][0]="", D[N][1]=i==0?CP[1]:CD[1];	D[N][2]=i
			var multis=adds[i].split("*")
			for(var j=0; j<multis.length; j++){
				var props=multis[j].replace("-.","-0.").split("±")
				var prop=props[0]
				var number=Number(prop)
				if(!isNaN(number)){D[N][1]*=number}
				else{
					var propValue=parseFloat(prop)
					var valueStrLen

					if(prop[0]==".")		valueStrLen=propValue.toString().length-1
					else if(propValue==0)	valueStrLen=1
					else if(!propValue){	valueStrLen=0;		propValue=1			}
	 				else{					valueStrLen=propValue.toString().length	}
					var propName=prop.substr(valueStrLen,prop.length-valueStrLen)
					var propIndex
					if(C.includes(propName)){propIndex=L[propName]}
					else {
						propIndex=1
 		 			}
					if(propIndex==1&&propName!=C[3]){
						if(D[N][0])D[N][0]+="."
						D[N][0] += propName
					}
					if(isNaN(D[N][propIndex]))D[N][propIndex]=1
					D[N][propIndex]*=propValue;		E[N][propIndex]=props[1] ? parseFloat(props[1]):D[N][2]==0?0:CE[propIndex]
				}
			}
			for(var ii=1; ii<C.length; ii++){if(isNaN(D[N][ii])) D[N][ii]=D[N][2]==0?CP[ii]:CD[ii];	if(isNaN(E[N][ii])) E[N][ii]=D[N][2]==0?0:CE[ii]}
		}
		var LEN=D[par][1]
		var NLEN=LEN>0&&LEN<1?1/LEN:LEN
		for(var j=0; j<NLEN;j++){Np=Np.concat(Np_);Nl=Nl.concat(Nl_)}

	}
	updateL();go=1;
}
function DE2B(){
	Bdv=[];Bdc=[];n=0
	if(U)U2d.clearRect(0,0,U.width,U.height);
	if(G && G.length>0 && G!=""){
		for(var i=0;i<G.length;i++){
			var GiPair = G[i].split("=");
			var valuePair=GiPair[1].split("±");
			var dValue
			if(GiPair[0][GiPair[0].length-2]==".")dValue=vdScript(valuePair[0],getD(GiPair[0]))
			else dValue=vdScript(valuePair[0],L[GiPair[0]])
			var eValue=valuePair.length==1?"":"±"+vdScript(valuePair[1],getE(GiPair[0]))
			setVar(GiPair[0]+":"+dValue+eValue);
		}
	}
	var Px,Py,Pz,Pr,Pg,Pb,Pu,Pv,Pw,Pend, Pcount=0
	for(var Ni=Np.length-1; Ni>=0; Ni--){
		var i=Np[Ni]
		var l=Nl[Ni]
		if(D[i][2]==l){
			var LEN=DE(i-l,1)
			var FRAC=LEN<1&&LEN>0
			var NLEN=FRAC?1/LEN:Math.ceil(LEN)
			if(Pcount<=0)Pcount=NLEN
			else Pcount--
			var S=FRAC?Pcount/NLEN:-1
			Px=DE(i-l,4,S);	Py=DE(i-l,5,S); Pz=DE(i-l,6,S)
			Pr=DE(i-l,7,S);		Pg=DE(i-l,8,S);	Pb=DE(i-l,9,S)
			Pu=DE(i-l,10,S);		Pv=DE(i-l,11,S);	Pw=DE(i-l,12,S)
		}
		var len=DE(i,1)
		var isFrac=len<1&&len>0
		var jlen=isFrac?1/len:Math.ceil(len)
		var pdep=DE(i,3)*DE(i-D[i][2],3)
		var nn=0
		var PArray=D[i][0].split(".")

		dv[Ni]=[];dc[Ni]=[];dvx[i]=0;dvy[i]=0,dvz[i]=0
		for(var j=0; j<jlen; j++){
			var s=isFrac?j/jlen:-1
			var d=DE(i,13,s)
			if(PArray.length>1){
				var ii = d<0?0:d>=1?PArray.length-2:Math.floor((PArray.length-1)*d)
				var i0 = L[PArray[ii]]
				var i1 = L[PArray[ii+1]]
				if(i0 && i1){
					var d2 = (PArray.length-1)*d-ii
					var x=(1-d2)*DE(i0,4,s)+d2*DE(i1,4,s),	y=(1-d2)*DE(i0,5,s)+d2*DE(i1,5,s),	z=(1-d2)*DE(i0,6,s)+d2*DE(i1,6,s)
					var r=(1-d2)*DE(i0,7,s)+d2*DE(i1,7,s),	g=(1-d2)*DE(i0,8,s)+d2*DE(i1,8,s),	b=(1-d2)*DE(i0,9,s)+d2*DE(i1,9,s)
					var u=(1-d2)*DE(i0,10,s)+d2*DE(i1,10,s),	v=(1-d2)*DE(i0,11,s)+d2*DE(i1,11,s),	w=(1-d2)*DE(i0,12,s)+d2*DE(i1,12,s)				
				}
			}
			else{
				var x=DE(i,4,s),		y=DE(i,5,s),		z=DE(i,6,s)
				var r=DE(i,7,s),		g=DE(i,8,s),		b=DE(i,9,s)
				var u=DE(i,10,s),		v=DE(i,11,s),		w=DE(i,12,s)				
			}
			var	pii = 2*Math.PI
			//Speed up with matrix calc
			var x1=u*Math.sin(v*pii)*Math.cos(w*pii)+x, 	y1=u*Math.cos(v*pii)+y,			z1=u*Math.sin(v*pii)*Math.sin(w*pii)+z
			var x2=x1*Math.cos(Pv*pii)+y1*Math.sin(Pv*pii),						y2=(y1*Math.cos(Pv*pii)-x1*Math.sin(Pv*pii))*Pu+Py
			var x3=(x2*Math.cos(-Pw*pii)+z1*Math.sin(-Pw*pii))*Pu+Px, 	z2=(z1*Math.cos(-Pw*pii)-x2*Math.sin(-Pw*pii))*Pu+Pz
			var	x4=Vv==0?x3:x3*Math.cos(Vv*pii)+y2*Math.sin(Vv*pii);	y3 =Vv==0?y2:y2*Math.cos(Vv*pii)-x3*Math.sin(Vv*pii)
			var zScale=z2>=1.9?2:1/(2-z2),	m=j*4
			var x5=x4*zScale, y4 = y3*zScale
			var r1=r*zScale*Pr, g1=g*zScale*Pg, b1=b*zScale*Pb
		
			dv[Ni].push(x5,y4,z2/10,1); dc[Ni].push(r1,g1,b1,1)
			dvx[i]+=x4; dvy[i]+=y3; dvz[i]+=z2
		}
		var jlenT=Math.ceil(jlen)
		dvx[i]/=jlenT;dvy[i]/=jlenT;dvz[i]/=jlenT
		updateUP(i,Font,1)
		if(dv[Ni]){
			dvi[Np.length-Ni-1]=Bdv.length
			var skip=pdep<1&&pdep>=0?Math.ceil(pdep*dv[Ni].length):dv[Ni].length
			Bdv = Bdv.concat(dv[Ni].slice(0,skip));Bdc = Bdc.concat(dc[Ni].slice(0,skip))
		
		}
		n+=jlen+nn
	}
	dvi[Np.length]=Bdv.length
	算 =Math.round(n)
	updateU()
}
function draw(a) {
	if(!a)a=1
	var Bv,Bc
	gl.lineWidth(LS)
	Gfrag=loadShader(gl,gl.FRAGMENT_SHADER,"varying lowp vec4 vColor; void main(void) {gl_FragColor=vColor;}")
	Gvert=loadShader(gl,gl.VERTEX_SHADER,"attribute vec4 aVxyz; attribute vec4 aVrgb; varying lowp vec4 vColor; void main(void) {gl_Position =vec4(aVxyz); gl_PointSize="+VS+";vColor=aVrgb;}")
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	var Gprog=gl.createProgram()
	gl.attachShader(Gprog, Gvert);		gl.attachShader(Gprog, Gfrag)
	gl.linkProgram(Gprog); gl.useProgram(Gprog)
	BvAtt=gl.getAttribLocation(Gprog, "aVxyz");	gl.enableVertexAttribArray(BvAtt)
	BcAtt=gl.getAttribLocation(Gprog, "aVrgb");	gl.enableVertexAttribArray(BcAtt)


	Bv=gl.createBuffer(); 	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdv), gl.DYNAMIC_DRAW)
	Bc=gl.createBuffer();	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdc), gl.DYNAMIC_DRAW)

	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.vertexAttribPointer(BvAtt, 4, gl.FLOAT, 0, 0, 0)
	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.vertexAttribPointer(BcAtt, 4, gl.FLOAT, 0, 0, 0)
	for(var Ni=0;Ni<Np.length; Ni++){
		var i=Np[Np.length-Ni-1]
		var type=Math.floor(D[i][15]+D[i-D[i][2]][15])
		gl.drawArrays(type==2?gl.TRIANGLE_FAN:type==1?gl.LINE_STRIP:gl.POINT, (dvi[Ni])/4, ((dvi[Ni+1]-dvi[Ni])/4))
	}
}

function showPosition(position){
	LAT=(90-position.coords.latitude)/360
	LON=(360-position.coords.longitude)/360
	ALT = position.coords.altitude
	var lat = Math.round(100*LAT)/100+""
	var lon = Math.round(100*LON)/100+""
	GPS=lat.replace("0.",".")+lon.replace("0.",".")
}
function setM(ev){MxB.unshift(Mx);MyB.unshift(My);Mx=decimal3(ev.clientX/SS);My=decimal3(1-(ev.clientY/SS))}
function start(){
	V=document.getElementById("glcanvas")
	I=document.getElementById('imgcanvas')
	U=document.getElementById('uicanvas')
	
	inF();inG();outVar()
	U.ontouchstart=function(ev){
		touch=1
		setM(ev.touches[0])
	}
	U.onmousedown=function(ev){
		touch=1
		setM(ev)
	}
	U.ontouchmove=function(ev){
	if((gLog.value.includes("Mx")||gLog.value.includes("My"))&&ev.touches.length==1)ev.preventDefault();setM(ev.touches[0]);go=1}
	U.onmousemove=function(ev){if(touch)setM(ev);go=1}
	U.ontouchend=function(ev){MxB=[];MyB=[];touch=0}
	U.onmouseup=function(ev){MxB=[];MyB=[];touch=0}
	document.onkeyup=function(ev){key="";keyB.unshift(ev.code);if(keyB.length>100)keyB.pop()}
	document.onkeydown=function(ev){key=ev.code}
	window.ondeviceorientation=function(ev){Rz=ev.alpha/360;Ry=ev.beta/360;Rx=ev.gamma/360}
	window.ondevicemotion=function(ev){var eva=ev.accelerationIncludingGravity;ax=eva.x;ay=eva.y;az=eva.z}
	navigator.geolocation.getCurrentPosition(showPosition)	
	V.width=SS;V.height=SS
	I.width=SS;I.height=SS
	U.width=SS;U.height=SS

	gl=V.getContext("webgl")
	I2d=I.getContext('2d')
	U2d=U.getContext('2d')
	init()
}
function loop(){
	time= new Date().getTime()
	if(dT!=0&&time-qTime>dT*1000){qTime=time;go=1}
	if(go){
		DE2B(D,E);DE2F()
		out=T+";"+HE()+GPS+";SS:"+SS+";Font:"+Font+" ;VS:"+VS+";LS:"+LS+";Vv:"+Vv+";dT:"+dT+";C:"+C+"; CD:"+CD+";CE:"+CE+";G:"+G+";F:"+F+";"+A;
		saveD.value="D_"+T+" ("+kb(out)+")"
		saveF.value="F_"+T+" ("+kb(F)+")"
		saveG.value="G_"+T+" ("+kb(gLog.value)+")"
		go=0;
		draw()
	}
	 ping= new Date().getTime()-time
	window.requestAnimationFrame(loop);
}

function vdScript(s,exc){
	var ext=""
	if(s&&(s.split("?").length-1)==(s.split("!").length))ext=":"+(exc?exc:"0")
	var s2=s?s.replace(/!/g,":").replace(/></g,"==").replace(/<>/g,"!=").replace(/<</g,"<=").replace(/>>/g,">=").replace(/([XYZ])\((\w+)\)/g,"get$1\('$2'\)").replace(/([DENSW])\((\w+).(\w+)\)/g,"get$1\('$2.$3'\)").replace(/∞/g,"%")+ext:0
	return eval(s2)
}
function id(s){return document.getElementById(s)}
function inF(){fLog.value=F.replace(/\+/g,"\n+").replace(/,/g,",\n").replace("=","\n=");}
function outF(){F=fLog.value.replace(/\n\+/g,"+").replace(/,\n/g,",").replace("\n=","=");F2DE()}
function inG(){gLog.value=G.join(",").replace(/,/g,",\n")}
function outG(){G=gLog.value.replace(/,\n/g,",").split(",");}
function outVar(){valtxt.value=this[vartxt.value]}
function outVal(){setVar(vartxt.value+":"+valtxt.value);outVar()}
function getX(s){return dvx[L[s]]}
function getY(s){return dvy[L[s]]}
function getZ(s){return dvz[L[s]]}
function getD(s){var pair=s.split(".");return L[pair[0]]?D[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getE(s){var pair=s.split(".");return L[pair[0]]?E[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getN(s){return L[s]?parseFloat(L[s]):0}
function getS(s){return L[s]?L[s]+"":""}
function getW(s){
	var sArr=s.split(".")
	var i=parseInt(sArr[0])
	var j=parseInt(sArr[1])
	return !com[i]?0:com[i][j]?com[i][j]:0
}
function getVar(s){return s+":"+this[s]}
function loadShader(gl, type, source) {const shader = gl.createShader(type);gl.shaderSource(shader, source);gl.compileShader(shader);return shader;}
function c(v){return v.charCodeAt()}
function kb(s){return s.length/1000+" kb"}
function DE(i,j,s){return D[i][j]+Err(i,j,s);}
function Err(i,j,s){ if(E[i][j]==0)return 0;else if(s>=0)return E[i][j]*(2*s-1); else return E[i][j]*(Math.random()-Math.random())}
function big(v){return v>61?String.fromCharCode(v+945-62): v>35?String.fromCharCode(v+61):v>9?String.fromCharCode(v+55):v}
function big60(v){return ""+big(Math.floor(v/3600))+big(Math.floor((v%3600)/60))+big(v%60)}
function HE(){var date=new Date();return big60(11900+date.getYear())+big(date.getMonth()+1)+big(date.getDate())+big(date.getHours())+big(date.getMinutes())+big(date.getSeconds())+big(Math.floor(date.getMilliseconds()/40))}
function vib(ms){if(抖 )navigator.vibrate(ms)}
function decimal3(v){return Math.round(v*1000)/1000}
</script>
<style>
	html,body{margin:1px;padding:0}
	#imgcanvas,#uicanvas{position:absolute;left:1px;top:1px}

</style>
</head><body onload="start()">
<canvas id="imgcanvas"></canvas>
<canvas id="uicanvas"></canvas>
<canvas id="glcanvas"></canvas></br>
<input id="loadD" type="file" onchange="readTextFile()"></input>
<input id="saveD" type="button" value="D" onclick="download('D',out,'txt')"></input>
	
<p><input id="vartxt" onchange="outVar()" type="text" value="T">:<input id="valtxt" onchange="outVal()" type="text"></p>
<input id="loadF" type="file" onchange="readF()"></input>
<input id="saveF" type="button" onclick="download('F',F,'txt')"></input></br>
<textarea id="fLog" cols="48" rows="20" onchange="outF()" onfocus="inF()"></textarea>
<p><input id="loadG" type="file" onchange="readG()"></input>
<input id="saveG" type="button" onclick="download('G',G,'txt')"></input></br>
<textarea id="gLog" cols="48" rows="10" onchange="outG()" onfocus="inG()"></textarea></p>
<br>

<div id="imagediv">
Image:<input id="imgInput" type="file" accept="image/*;capture=camera" onchange="readImgFile(0)"></inpu>
</div>
</body></html>