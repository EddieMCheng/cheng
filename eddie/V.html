<!--http://eddie.cheng.se/V.html -->
<!doctype html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><script type="text/javascript">
/*
	@copyright ©2018
	@author Eddie Cheng

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
var F="Box*.25*w±.5=lin*.25*z*1.414u*.375v±.5*a"
var G=["Vw=Mx"]
var V,I,U,gl,I2d,U2d,img=new Image,images=[],BvAtt,Bdv=[],BcAtt,Bdc=[],dv=[],dc=[],dvx=[],dvy=[],dvz=[],dvX=[],dvY=[],dvZ=[],dva=[],dvi=[]
var A,all,out,T="New"
var C="slipxyzrgbuvwdta";	CP=["P",1,0,1,0,0,0,1,1,1,1,0,0,0,0,0], CD=["p",1,0,1,0,0,0,1,1,1,0,0,0,.5,0,0], CE=["±",0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0]
var B=[],D=[],E=[],L=[],P=[],X=[],Y=[],Z=[],N=0,Np=[],Nl=[],Font="12px",LS=1.5,VS="2.0",VP=1,VF=1,Vv=0,Vw=0,SS=512,IS=1,Va=1
var Mx=0,Mx_0=0,Mx_1=0,My=0,My_0=0,My_1=0,touch=0,drag=0,key="",MxB=new Array(5).fill(0),MyB=new Array(5).fill(0),keyB=new Array(10).fill(""),算,抖=1
var Rx=0,Ry=0,Rz=0,ax=0,ay=0,az=0
var Gfrag,Gvert,vibms,go=1,time=0,iT=1,dT=0,dA=1,qTime=0, ping=0,timeZone=new Date().getTimezoneOffset()/60;
var GPS=".25"+((Math.round(100*(24+(timeZone)%24)/24)/100)+"").replace("0.","."),LAT=.25,LON=0,ALT
var websock=[],W="",dat=[],thisIdx=0;
updateL();F2DE();DE2B()
function init(){
	var ATD=window.location.href.replace("?",";").split(";");
	A=ATD[0];if(ATD[1]){readTextUrl(ATD[1].endsWith(".txt")?ATD[1]:ATD[1]+".txt");updateD(1,ATD)}
	if(gl){
		gl.clearColor(0,0,0,1)
		gl.blendFunc(gl.SRC_ALPHA, gl.ONE);
		gl.enable(gl.BLEND);
		gl.disable(gl.DEPTH_TEST);
		gl.lineWidth(LS)
		Gfrag=loadShader(gl,gl.FRAGMENT_SHADER,"varying lowp vec4 vColor; void main(void) {gl_FragColor=vColor;}")
		Gvert=loadShader(gl,gl.VERTEX_SHADER,"attribute vec4 aVxyz; attribute vec4 aVrgb; varying lowp vec4 vColor; void main(void) {gl_Position =vec4(aVxyz); gl_PointSize="+VS+";vColor=aVrgb;}")
		window.requestAnimationFrame(loop)
	}
}
function start(){
	V=document.getElementById("glcanvas")
	I=document.getElementById('imgcanvas')
	U=document.getElementById('uicanvas')
	inF();inG();outVar()
	U.ontouchstart=function(ev){setM1(ev.touches[0])}
	U.onmousedown=function(ev){setM1(ev)}
	U.ontouchmove=function(ev){if((gLog.value.includes("Mx")||gLog.value.includes("My"))&&ev.touches.length==1)ev.preventDefault();setM(ev.touches[0])}
	U.onmousemove=function(ev){if(touch)setM(ev)}
	U.ontouchend=function(ev){setM0(ev.touches[0])}
	U.onmouseup=function(ev){setM0(ev)}
	document.onkeydown=function(ev){key=ev.code+"_1";setKeyB(ev);if(ev.code=="Escape"){inF();inG()}else if(ev.code=="Enter"&&ev.ctrlKey){outF();outG();outVar()}}
	document.onkeyup=function(ev){key=ev.code+"_0"}
	window.ondeviceorientation=function(ev){Rz=ev.alpha/360;Ry=ev.beta/360;Rx=ev.gamma/360}
	window.ondevicemotion=function(ev){var eva=ev.accelerationIncludingGravity;ax=eva.x;ay=eva.y;az=eva.z}
	navigator.geolocation.getCurrentPosition(showPosition)
	V.width=SS;V.height=SS
	I.width=SS;I.height=SS
	U.width=SS;U.height=SS

	gl=V.getContext("webgl")
	I2d=I.getContext('2d')
	U2d=U.getContext('2d')
	init()
}
function loop(){
	time= new Date().getTime()
	if(dT!=0&&time-qTime>dT*1000){qTime=time;go=1}
	if(go){
		for(var i=0;i<iT;i++)DE2B()
		DE2F()
		out=T+";"+HE()+GPS+";SS:"+SS+";Font:"+Font+";VS:"+VS+";LS:"+LS+";Va:"+Va+";Vv:"+Vv+";Vw:"+Vw+";iT:"+iT+";dT:"+dT+";C:"+C+"; CD:"+CD+";CE:"+CE+";G:"+G+";F:"+F+";"+A;
		saveD.value="D_"+T+" ("+kb(out)+")"
		saveF.value="F_"+T+" ("+kb(F)+")"
		saveG.value="G_"+T+" ("+kb(gLog.value)+")"
		go=0
		draw()
	}
	 ping= new Date().getTime()-time
	window.requestAnimationFrame(loop);
}

function updateT(s){
	if(s)T=s.replace("D_","").split(".")[0]; document.title="VD - "+T.replace(/_/g," ");if(!window.location.href.includes(";")) window.history.pushState(null, "Title", "?D_"+T)
}
function updateD(Tidx,arr){
	if(Tidx>=0)updateT(arr[Tidx])
		for(var i=0;i<arr.length;i++){
			if(arr[i].includes(":")&&!arr[i].includes("file:")&&!arr[i].includes("https:"))setVar(arr[i])
		}
	outVar();
	inF();
	inG();
}
function readTextFile(){
	var file=loadD.files[0], reader = new FileReader()
	reader.onload=function(e){updateD(0,reader.result.split(";"))}
	reader.readAsText(file);
}
function readF(){
	var rdr=new FileReader()
	rdr.onload=function(){F=F+","+rdr.result.replace(/\r\n/g,"");inF();F2DE();}
	rdr.readAsText(loadF.files[0])
}
function readG(){
	var rdr=new FileReader()
	rdr.onload=function(){G=rdr.result.split(",");inG()}
	rdr.readAsText(loadG.files[0])
}
function readTextUrl(file){
	var raw = new XMLHttpRequest(); raw.open("GET", file, true); 
	raw.onreadystatechange = function (){
		if(file && raw.readyState==4&&(raw.status==200||raw.status==0)){
			if(raw.responseText){updateD(0,raw.responseText.split(";"))}
			else if(file.includes("_"))readTextUrl(file.replace("_","/"))
			document.title=T
		}
		else if(raw.status==404 && file.includes("_"))readTextUrl(file.replace("_","/"))
	}
	raw.send(null);
}
function readImgFile(idx){images[idx]=new Image;images[idx].onload=function(){updateI(idx)};setVar("Va:0.5");images[idx].src=URL.createObjectURL(imgInput.files[0])}

function updateI(idx){
	if(I){
		I2d.scale(IS,IS)
		I2d.clearRect(0,0,I.width,I.height)
			if(idx>=0)img = images[idx]
			if(img){
			var cutw=img.width>img.height?img.width-img.height:0; var cuth=img.height>img.width?img.height-img.width:0 
			I2d.drawImage(img,-cuth/2,-cutw/2,img.width+cuth,img.height +cutw,0,0,SS,SS)
		}
	}
}
function updateUP(i,font,alpha){
	if(U){
		var goName=(L[D[i][0]+".name"]+"")
		var goFont=L[D[i][0]+".font"]
		var goAlign=L[D[i][0]+".align"]
		var typeA=Math.abs(D[i][3])>=2||Math.abs(D[i-D[i][2]][3])>=2
		U2d.textAlign =goAlign?goAlign:"left"
		U2d.fillStyle='rgba('+getByte(i,"r")+','+getByte(i,"g")+','+getByte(i,"b")+','+(Z[i]*typeA*alpha)+')'
		U2d.font=goFont?goFont:font
		U2d.textBaseline = "top"
    	var names=typeA? D[i][0].split("."):" "
		var dots=names.length>1?"...":"";
		U2d.fillText(goName!="undefined"?goName:(names[0]+dots),(SS/2)+X[i]*(SS/2),(SS/2)-Y[i]*(SS/2))
	}
}
function download(type, text, ext) {
	filename= type+"_"+T+"_"+HE()+GPS+"."+ext
	var pom = document.createElement('a'); pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + text); pom.setAttribute('download', filename);
	if (document.createEvent) {var event = document.createEvent('MouseEvents'); event.initEvent('click', true, true);pom.dispatchEvent(event);}
	else pom.click();
}
function addF(s){
	if(!F.includes(s)){F+="+"+s;inF();F2DE()}
}
function setVar(s){
	if(s){
		var sPair=s.split(":")
		var sVal=s.includes(",")?sPair[1].split(",").map(x=>parseFloat(x)?parseFloat(x):x):sPair[1]
		var sArr=sPair[0].split(".")
		if(sArr.length>1 && L[sArr[0]]!=undefined){
			var sName=sArr[0]
			var sType=sArr[sArr.length-1]
			if(sType == "name" || sType == "font" || sType=="align")L[sPair[0]]=sPair[1]
			else if(sType=="s")D[L[sName]][0]=sPair[1]
			else if(sType.length==1 && sType.search(/[a-z]/g)==0){
				var sDE=sVal.split("±")
				D[L[sName]][L[sType]]=decimal3(parseFloat(sDE[0]))
				if(sDE.length==2)E[L[sName]][L[sType]]=decimal3(parseFloat(sDE[1]))
			}
			else{L[sPair[0]]=sVal}
		}
		else if(sArr[0]=="echo")alert(this[sVal])
		else if(sArr[0]=="IS"){
			IS=sVal
			updateI()
		}
		else if(sArr[0]=="Va"){
			Va=sVal
			gl.clearColor(0,0,0,Va)
			go=1
		}
		else if(sArr[0]=="SS"){
			SS=sVal
			V.width=SS;V.height=SS
			I.width=SS;I.height=SS
			U.width=SS;U.height=SS
			datadiv.style.left=(parseInt(SS)+10)+"px"
			updateI()
			gl.viewport(0,0,SS,SS)
		}
		else if(sArr[0]=="LS"){LS=sVal;gl.lineWidth(LS)}
		else if(sArr[0]=="VS"){VS=sVal;Gvert=loadShader(gl,gl.VERTEX_SHADER,"attribute vec4 aVxyz; attribute vec4 aVrgb; varying lowp vec4 vColor; void main(void) {gl_Position =vec4(aVxyz); gl_PointSize="+VS+";vColor=aVrgb;}")}
		else if(sArr[0]=="F"){F=sPair[1];inF();F2DE()}
		else if(sArr[0]=="G"){G=sPair[1].split(",");inG()}
		else if(sArr[0]=="T")updateT(sVal)
		else if(sArr[0]=="W"){
			W=sPair[1]
			var dataArray=W.split(",")
			for(var i=0;i<dataArray.length;i++){
				com[i] = []
				websock[i] = new WebSocket('ws://'+dataArray[i]);
				websock[i].idx=i;
				websock[i].onmessage = function(evt) {
					if(evt.data.includes(",")){
						com[this.idx]=evt.data.split(",")
					}
				}	
			}
			updateT(T)
		}
		else if(sArr.length == 1)this[sArr[0]]=sVal.includes(",")?sVal.split(","):sVal
	}
}
function updateL(){
	L=[]
	for(var i=0; i<C.length; i++){L[C[i]]=i}
	L["#N"]=D.length-1
	for(var j=D.length-1;j>=0;j--){
		var par=j-D[j][2]
		var nm=D[j][0].split(".")[0];
		var nNm = nm
		var dp=0
		while((L[nNm] || L[nNm+"_"+dp]) && dp<D.length-1){
			var nmLen=nm.lastIndexOf("_")
			var nmArr=nmLen<0?nm:nm.substring(0,nmLen)
			var nmEndStr= parseInt(nm.substring(nmLen,nm.length)+1)
			nNm=nmEndStr?nmArr+"_"+nmEndStr:nmArr+"_"+dp
			dp++
		}
		L[nNm]=j
		L["#"+j]=j
		D[j][0]=D[j][0].replace(nm,nNm)
		D[j-1][0]=D[j-1][0].replace("."+nm,"."+nNm)
	 }
}
function DE2F(){
	F=""
	var C0
	for(var i=0; i<N+1; i++){
		if(D[i][2]==0)C0=CP
		else C0 = CD
		if(D[i][2]==0&&i>0)F+=","
		F+=D[i][0]
		if(D[i][1]>0&&D[i][1]!=CD[1])F+="*"+(D[i][1]+"")
		for(var j=3;j<C.length;j++){
			var CEj=D[i][2]==0?0:CE[j]
			if(j!=2 && (D[i][j]!=C0[j]||E[i][j]!=CEj)&&(D[i][2]!=0||j!=1)){
				if(j>0)F+="*"
				if(D[i][j]!=1)	F+=(D[i][j]+"")
				if(j>2){		F+=C[j];if(E[i][j]!=CEj)F+="±"+(E[i][j]+"")}
			}
		}
		if(D[i][2]==0)F+="="
		else if(i<N && D[i+1][2]!=0) F+="+"
	}
}
function F2DE(){
	F=decodeURI(F)
	var commas=F.split(",")
	N=-1
	Np=[],D=[],E=[],Nl=[]
	for(var I=0; I<commas.length; I++){
		var adds=commas[I].replace("=","+").split("+")
		var Np_=[],Nl_=[]
		var par=N+1
		for(var i=0; i<adds.length; i++){
			N++
			if(i>0){Np_.push(N);Nl_.push(adds.length-1)}
			D[N]=[], E[N]=[],	D[N][0]="", D[N][1]=i==0?CP[1]:CD[1];	D[N][2]=i
			var multis=adds[i].split("*")
			for(var j=0; j<multis.length; j++){
				var props=multis[j].split("±")
				var prop=props[0]
				var number=Number(prop)
				if(!isNaN(number)){D[N][1]*=number}
				else{
					var propValue=parseFloat(prop)
					var valueStrLen
					if(prop[0]==".")		valueStrLen=propValue.toString().length-1
					else if(propValue==0)	valueStrLen=1
					else if(!propValue){	valueStrLen=0;		propValue=1			}
	 				else{					valueStrLen=propValue.toString().length	}
					var propName=prop.substr(valueStrLen,prop.length-valueStrLen)
					var propIndex
					if(C.includes(propName)){propIndex=L[propName]}
					else {
						propIndex=1
 		 			}
 		 			
					if(propIndex==1&&propName!=C[3]){
						if(propName.endsWith("...")&&N>0){
	 		 				propName=propName.replace("...","")
	 		 				for(n=N-1;n>0;n--){
	 		 					if(D[n][0].beginsWith(propName)&&D[n][2]!=0){
	 		 						alert(propName+"-->"+D[n][0])
	 		 					}
	 		 				}
	 		 			}
	 		 			else{
							if(D[N][0])D[N][0]+="."
							D[N][0] += propName
						}
					}
					if(isNaN(D[N][propIndex]))D[N][propIndex]=1
					D[N][propIndex]*=propValue;		E[N][propIndex]=props[1] ? parseFloat(props[1]):D[N][2]==0?0:CE[propIndex]
				}
			}
			for(var ii=1; ii<C.length; ii++){if(isNaN(D[N][ii])) D[N][ii]=D[N][2]==0?CP[ii]:CD[ii];	if(isNaN(E[N][ii])) E[N][ii]=D[N][2]==0?0:CE[ii]}
		}
		var LEN=D[par][1]
		var NLEN=LEN>0&&LEN<1?1/LEN:LEN
		for(var j=0; j<NLEN;j++){Np=Np.concat(Np_);Nl=Nl.concat(Nl_)}

	}
	updateL();go=1;
}
function DE2B(){
	Bdv=[];Bdc=[];n=0
	if(U)U2d.clearRect(0,0,U.width,U.height);

	var Px,Py,Pz,Pr,Pg,Pb,Pu,Pv,Pw,Pend, Pcount=0
	for(var Ni=Np.length-1; Ni>=0; Ni--){
		var i=Np[Ni]
		var l=Nl[Ni]
		if(D[i][2]==l){
			var LEN=DE(i-l,1)
			var FRAC=LEN<1&&LEN>0
			var NLEN=FRAC?1/LEN:Math.ceil(LEN)
			if(Pcount<=1)Pcount=NLEN
			else Pcount--
			var S=FRAC?Pcount/NLEN:-1
			Px=DE(i-l,4,S);	Py=DE(i-l,5,S); Pz=DE(i-l,6,S)
			Pr=DE(i-l,7,S);	Pg=DE(i-l,8,S);	Pb=DE(i-l,9,S)
			Pu=DE(i-l,10,S);Pv=DE(i-l,11,S);Pw=DE(i-l,12,S
			)
		}
		
		var len=DE(i,1)	
		var type = D[i][15]+D[i-D[i][2]][15]
		var isFrac=(len<1&&len>0)||(type>0&&len==1)
		var jlen=isFrac?1/(len-1e-4):Math.ceil(len)
		var p=DE(i,3)*DE(i-D[i][2],3), pdep=p<0?-p:p
		var nn=0
		var PArray=D[i][0].split(".")

		dv[Ni]=[];dc[Ni]=[];dvx[i]=0;dvy[i]=0;dvz[i]=0;dvX[i]=0;dvY[i]=0;dvZ[i]=0;X[i]=0;Y[i]=0;Z[i]=0
		for(var j=0; j<jlen*(pdep%1.0001); j++){
			var s=isFrac?j/jlen:-1
			var d=DE(i,13,s)
			if(PArray.length>1){
				var ii = d<0?0:d>=1?PArray.length-2:Math.floor((PArray.length-1)*d)
				var i0 = L[PArray[ii]]
				var i1 = L[PArray[ii+1]]
				if(i0 && i1){
					var d2 = (PArray.length-1)*d-ii
					var x=(1-d2)*DE(i0,4,s)+d2*DE(i1,4,s),	y=(1-d2)*DE(i0,5,s)+d2*DE(i1,5,s),	z=(1-d2)*DE(i0,6,s)+d2*DE(i1,6,s)
					var r=(1-d2)*DE(i0,7,s)+d2*DE(i1,7,s),	g=(1-d2)*DE(i0,8,s)+d2*DE(i1,8,s),	b=(1-d2)*DE(i0,9,s)+d2*DE(i1,9,s)
					var u=(1-d2)*DE(i0,10,s)+d2*DE(i1,10,s),	v=(1-d2)*DE(i0,11,s)+d2*DE(i1,11,s),	w=(1-d2)*DE(i0,12,s)+d2*DE(i1,12,s)				
				}
			}
			else{
				var x=DE(i,4,s),		y=DE(i,5,s),		z=DE(i,6,s)
				var r=DE(i,7,s),		g=DE(i,8,s),		b=DE(i,9,s)
				var u=DE(i,10,s),		v=DE(i,11,s),		w=DE(i,12,s)				
			}
			var	pii = 2*Math.PI,x1,x2,x3,x4,x5,y1,y2,y3,z1,z2,z3
			x1=u*Math.sin(v*pii)*Math.cos(w*pii)+x, 				y1=u*Math.cos(v*pii)+y,	z1=u*Math.sin(v*pii)*Math.sin(w*pii)+z
			x2=Pv==0?x1:x1*Math.cos(Pv*pii)+y1*Math.sin(Pv*pii),				y2=Pv==0?y1*Pu+Py:(y1*Math.cos(Pv*pii)-x1*Math.sin(Pv*pii))*Pu+Py
			x3=Pw==0?x2*Pu+Px:(x2*Math.cos(-Pw*pii)+z1*Math.sin(-Pw*pii))*Pu+Px,z2=Pw==0?z1*Pu+Pz:(z1*Math.cos(-Pw*pii)-x2*Math.sin(-Pw*pii))*Pu+Pz
			x4=Vv==0||p<0?x3:x3*Math.cos(Vv*pii)+y2*Math.sin(Vv*pii);				y3=Vv==0||p<0?y2:y2*Math.cos(Vv*pii)-x3*Math.sin(Vv*pii)
			x5=Vw==0||p<0?x4:x4*Math.cos(-Vw*pii)+z2*Math.sin(-Vw*pii), 				z3=Vw==0||p<0?z2:z2*Math.cos(-Vw*pii)-x4*Math.sin(-Vw*pii)
			zScale=z3>1?z3*VP+1-VP:1/(2-(z3*VP+1-VP)),	m=j*4
			var xx=x5*zScale, yy = y3*zScale
			var r1=r*Pr, g1=g*Pg, b1=b*Pb, a1=z3*VF>1?1:1/(2-z3*VF)
			dv[Ni].push(xx,yy,1,1); dc[Ni].push(r1,g1,b1,a1)	
			dvx[i]+=x1; dvy[i]+=y1; dvz[i]+=z1
			dvX[i]+=x3; dvY[i]+=y2; dvZ[i]+=z2
			X[i]+=xx; Y[i]+=yy; Z[i]+=a1
		}
		var jlenT=Math.ceil(jlen)
		dvx[i]/=jlenT;dvy[i]/=jlenT;dvz[i]/=jlenT
		dvX[i]/=jlenT;dvY[i]/=jlenT;dvZ[i]/=jlenT
		X[i]/=jlenT;Y[i]/=jlenT;Z[i]/=jlenT
		updateUP(i,Font,1)
		if(dv[Ni]){
			dvi[Np.length-Ni-1]=Bdv.length
			Bdv = Bdv.concat(dv[Ni]);Bdc = Bdc.concat(dc[Ni])
		
		}
		n+=jlen+nn
	} 
	dvi[Np.length]=Bdv.length
	算 =Math.round(n)
	if(G && G.length>0 && G!=""){
		for(var i=0;i<G.length;i++){
			var GiPair = G[i].split("=");
			var valuePair=GiPair[1].split("±");
			var dValue
			if(GiPair[0][GiPair[0].length-2]==".")dValue=vdScript(valuePair[0],getD(GiPair[0]))
			else dValue=vdScript(valuePair[0],L[GiPair[0]])
			var eValue=valuePair.length==1?"":"±"+vdScript(valuePair[1],getE(GiPair[0]))
			if(GiPair[0])setVar(GiPair[0]+":"+dValue+eValue);
		}
	}
}
function draw(a) {
	if(!a)a=1
	var Bv,Bc
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	var Gprog=gl.createProgram();gl.attachShader(Gprog, Gvert);gl.attachShader(Gprog, Gfrag);gl.linkProgram(Gprog);gl.useProgram(Gprog)

	BvAtt=gl.getAttribLocation(Gprog, "aVxyz");	gl.enableVertexAttribArray(BvAtt);	Bv=gl.createBuffer(); 	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdv), gl.DYNAMIC_DRAW)
	BcAtt=gl.getAttribLocation(Gprog, "aVrgb");	gl.enableVertexAttribArray(BcAtt);	Bc=gl.createBuffer();	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(Bdc), gl.DYNAMIC_DRAW)

	gl.bindBuffer(gl.ARRAY_BUFFER, Bv);	gl.vertexAttribPointer(BvAtt, 4, gl.FLOAT, 0, 0, 0)
	gl.bindBuffer(gl.ARRAY_BUFFER, Bc);	gl.vertexAttribPointer(BcAtt, 4, gl.FLOAT, 0, 0, 0)
	for(var Ni=0;Ni<Np.length; Ni++){
		var i=Np[Np.length-Ni-1],type=D[i][15]+D[i-D[i][2]][15]
		gl.drawArrays(type>3?gl.TRIANGLE_FAN:type>2?gl.TRIANGLE_STRIP:type>1?gl.TRIANGLES:type>0.5?gl.LINE_STRIP:type>0?gl.LINES:gl.POINT, (dvi[Ni])/4, ((dvi[Ni+1]-dvi[Ni])/4))
	}
}

function showPosition(position){
	LAT=(90-position.coords.latitude)/360;	LON=(360-position.coords.longitude)/360
	ALT = position.coords.altitude
	var lat = Math.round(100*LAT)/100+"", lon = Math.round(100*LON)/100+""
	GPS=lat.replace("0.",".")+lon.replace("0.",".")
}
function getMx(ev){return 2*decimal3(ev.pageX/SS)-1}
function getMy(ev){return 1-2*decimal3(ev.pageY/SS)}
function setM1(ev){Mx_1=getMx(ev);Mx=Mx_1;My_1=getMy(ev);My=My_1;setMB(ev);touch=1}
function setM0(ev){Mx_0=MxB[0];My_0=MyB[0];touch=0;drag=0}
function setM(ev){Mx=getMx(ev);My=getMy(ev);setMB(ev);drag=1}
function setMB(ev){MxB.pop();MxB.unshift(getMx(ev));MyB.pop();MyB.unshift(getMy(ev));if(!dT)go=1}
function setKeyB(ev){keyB.pop();keyB.unshift(ev.code);if(!dT)go=1}

function vdScript(s,exc){
	var ext=""
	if(s&&(s.split("?").length-1)==(s.split("!").length))ext=":"+(exc?exc:"0")
	var s2=s?s.replace(/!/g,":").replace(/></g,"==").replace(/<>/g,"!=").replace(/<</g,"<=").replace(/>>/g,">=").replace(/([xyzXYZ])\((\w+)\)/g,"get$1\('$2'\)").replace(/([DENSW])\((\w+).(\w+)\)/g,"get$1\('$2.$3'\)").replace(/∞/g,"%").replace(/\)\(/g,",")+ext:0
	return eval(s2)
}
function id(s){return document.getElementById(s)}
function inF(){fLog.value=F.replace(/\+/g,"\n+").replace(/,/g,",\n\n").replace(/=/g,"\n=");}
function outF(){F=fLog.value.replace(/\n/g,"");F2DE()}
function inG(){gLog.value=G.join(",\n")}
function outG(){G=gLog.value.replace(/,/g,"").split("\n");}
function outVar(){valtxt.value=this[vartxt.value]}
function outVal(){setVar(vartxt.value+":"+valtxt.value);outVar()}
function getx(s){t=dvx[L[s]];return t?t:0}
function gety(s){t=dvy[L[s]];return t?t:0}
function getz(s){t=dvz[L[s]];return t?t:0}
function getX(s){t=dvX[L[s]];return t?t:0}
function getY(s){t=dvY[L[s]];return t?t:0}
function getZ(s){t=dvZ[L[s]];return t?t:0}
function getD(s){var pair=s.split(".");return L[pair[0]]?D[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getE(s){var pair=s.split(".");return L[pair[0]]?E[L[pair[0]]][L[pair[pair.length-1]]]:0}
function getN(s){return L[s]?parseFloat(L[s]):0}
function getS(s){return L[s]?L[s]+"":""}
function getW(s){
	var sArr=s.split(".")
	var i=parseInt(sArr[0])
	var j=parseInt(sArr[1])
	return !com[i]?0:com[i][j]?com[i][j]:0
}
function getVar(s){return s+":"+this[s]}
function loadShader(gl, type, source) {const shader = gl.createShader(type);gl.shaderSource(shader, source);gl.compileShader(shader);return shader;}
function c(v){return v.charCodeAt()}
function kb(s){return s.length/1000+" kb"}
function DE(i,j,s){return D[i][j]+Err(i,j,s);}
function Err(i,j,s){ if(E[i][j]==0)return 0;else if(s>=0)return E[i][j]*(2*s-1); else return E[i][j]*(Math.random()-Math.random())}
function big(v){return v>61?String.fromCharCode(v+945-62): v>35?String.fromCharCode(v+61):v>9?String.fromCharCode(v+55):v}
function big60(v){return ""+big(Math.floor(v/3600))+big(Math.floor((v%3600)/60))+big(v%60)}
function HE(){var date=new Date();return big60(11900+date.getYear())+big(date.getMonth()+1)+big(date.getDate())+big(date.getHours())+big(date.getMinutes())+big(date.getSeconds())+big(Math.floor(date.getMilliseconds()/40))}
function vib(ms){if(抖 )navigator.vibrate(ms)}
function decimal3(v){return Math.round(v*1000)/1000}
function getByte(idx,s){return Math.floor(D[idx][L[s]]*255)}
function copy(){document.execCommand("copy");}
</script>
<style>
	html,body{margin:1px;padding:0}
	#imgcanvas{position:absolute;left:1px;top:5px;z-index:-10}
	#uicanvas{position:absolute;left:1px;top:5px}
	#datadiv{position:absolute;left:522px;top:5px;width:600px}
</style>
</head><body onload="start()">
<canvas id="imgcanvas"></canvas>
<canvas id="glcanvas"></canvas>
<canvas id="uicanvas"></canvas></br>
<div id="datadiv">
<input id="loadD" type="file" onchange="readTextFile()"></input>
<input id="saveD" type="button" value="D" onclick="download('D',out,'txt')"></input>
<p><input id="vartxt" onchange="outVar()" type="text" value="T">:<input id="valtxt" onchange="outVal()" type="text"></p>
<input id="loadF" type="file" onchange="readF()"></input>
<input id="saveF" type="button" onclick="download('F',F,'txt')"></input>
<input type="button" onclick="fLog.select();copy()" value="copy"></input></br>
<textarea id="fLog" cols="60" rows="10" onchange="outF()" onfocus="inF()"></textarea>
<p><input id="loadG" type="file" onchange="readG()"></input>
<input id="saveG" type="button" onclick="download('G',G,'txt')"></input>
<input type="button" onclick="gLog.select();copy()" value="copy"></input></br>
<textarea id="gLog" cols="60" rows="10" onchange="outG()" onfocus="inG()"></textarea></p>
<input value="update" type="button" onclick="inF();inG()"></input>
<input value="apply" type="button" onclick="outF();outG();outVar()"></input>
<input id="plusm" type="text" value="±" size=1></input>
<input type="button" onclick="plusm.select();copy()" value="±"></input>
<input id="inf" type="text" value="∞" size=1></input>
<input type="button" onclick="inf.select();copy()" value="∞"></input></br>
<br>
</div>
<div id="imagediv">
Image:<input id="imgInput" type="file" accept="image/*;capture=camera" onchange="readImgFile(0)"></inpu>
</div>
</body></html>
